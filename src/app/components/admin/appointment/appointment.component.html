<div class="grid">
  <div class="col-12 p-0">
    <div class="card admin-content m-0">
      <p-breadcrumb [model]="breadcrumbItem" [home]="home" styleClass="breadcrumb-admin"></p-breadcrumb>
      <!--End: Title Danh sách group -->
      <div class="flex">
        <div class="grid">
          <div class="col">
            <input type="text" [style]="{ height: '37px', width: '220px' }" pInputText placeholder="Tên khách hàng" [(ngModel)]="searchForm.name" />
          </div>
        </div>
        <div class="grid">
          <div class="col ml-3">
            <input type="text" [style]="{ height: '37px', width: '220px' }" pInputText placeholder="Số điện thoại" [(ngModel)]="searchForm.phoneNo" />
          </div>
        </div>
        <div class="grid">
          <div class="col ml-3">
            <p-dropdown placeholder="Chuyên khoa" [options]="lstDepartments" [style]="{ height: '37px', width: '220px' }" appendTo="body" optionLabel="name" optionValue="id" [(ngModel)]="searchForm.departmentId" [virtualScroll]="true" [ngModelOptions]="{ standalone: true }" [showClear]="true" [virtualScrollItemSize]="30"></p-dropdown>
          </div>
        </div>
        <div class="grid">
          <div class="col ml-3">
            <p-calendar [style]="{ height: '37px' }" [showClear]="true" class="w-full sm:w-auto p-inputtext-sm" [showButtonBar]="true" placeholder="Ngày đăng kí" [showIcon]="true" appendTo="body" [dateFormat]="'dd/mm/yy'" [(ngModel)]="searchForm.dateCreated"></p-calendar>
          </div>
        </div>
        <div class="grid">
          <div class="col ml-3">
            <p-calendar [showClear]="true" [style]="{ height: '37px' }" class="w-full sm:w-auto p-inputtext-sm" [showButtonBar]="true" placeholder="Ngày hẹn khám" [showIcon]="true" appendTo="body" [dateFormat]="'dd/mm/yy'" [(ngModel)]="searchForm.appointmentDate"></p-calendar>
          </div>
        </div>
        <div class="col-2 pl-3 -mt-3">
          <button pButton [style]="{ height: '37px' }" pRipple icon="pi pi-search" class="p-button-primary mr-3 p-button-sm" (click)="onSearch()"></button>
          <button pButton [style]="{ height: '37px' }" pRipple icon="pi pi-times" class="p-button-secondary p-button-sm" (click)="onClearSearch()"></button>
        </div>
      </div>
      <p-table styleClass="p-datatable-striped p-datatable-sm p-datatable-gridlines" class='table-admin' [scrollable]="true" scrollHeight="650px" [dataKey]="'id'" selectionMode="single" [(selection)]="selectedItem" [paginator]="true" [rows]="40" [rowsPerPageOptions]="[40, 60, 80]" [scrollable]="true" [value]="listItems" [totalRecords]="totalItemCount" (onPageChange)="onPageChange($event)" [loading]="loading">
        <ng-template pTemplate="header">
          <tr>
            <th [style.minWidth]="'2rem'" class="text-center">STT</th>
            <th [style.minWidth]="'15rem'">Họ tên</th>
            <th [style.minWidth]="'15rem'">SDT</th>
            <th [style.minWidth]="'15rem'">Chuyên khoa</th>
            <th [style.minWidth]="'15rem'">Trạng thái</th>
            <th [style.minWidth]="'15rem'">Ngày hẹn khám</th>
            <th [style.minWidth]="'15rem'">Ngày đặt lịch</th>
            <th [style.minWidth]="'13rem'">Khung giờ</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
          <tr (dblclick)="dbClickUpdate(rowData)">
            <td [style.minWidth]="'2rem'" class="text-center">{{ rowIndex + 1 }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['name'] }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['phoneNo'] }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['departmentName'] }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['status'] | appointmentStatusString }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['appointmentDate'] | date : 'hh:mm:ss dd/MM/yyyy' }}</td>
            <td [style.minWidth]="'15rem'">{{ rowData['dob'] | date : 'hh:mm:ss dd/MM/yyyy' }}</td>
            <td [style.minWidth]="'13rem'">{{ rowData['visitTime'] | date : 'hh:mm:ss dd/MM/yyyy' }}</td>
          </tr>
        </ng-template>
      </p-table>
    </div>
    <p-dialog [(visible)]="isVisibleAppointmentDlg" [style]="{ width: '65rem' }" [modal]="true" [header]="header" class="p-fluid">
      <ng-template pTemplate="content">
        <div class="grid">
          <div class="col-7">
            <div class="formgrid grid">
              <div class="field col">
                <label><strong>Họ tên</strong></label>
                <input type="text" pInputText placeholder="Tên" [(ngModel)]="selectedItem.name" [disabled]="true" />
              </div>
              <div class="field col">
                <label><strong>Giới tính</strong></label>
                <p-dropdown placeholder="Giới tính" [options]="GENDERS" [(ngModel)]="selectedGender" [disabled]="true" optionLabel="label"></p-dropdown>
              </div>
            </div>
            <div class="formgrid grid">
              <div class="field col">
                <label><strong>Địa chỉ</strong></label>
                <input type="text" pInputText placeholder="Địa chỉ" [(ngModel)]="selectedItem.address" [disabled]="true" />
              </div>
              <div class="field col">
                <label><strong>Số điện thoại</strong></label>
                <input type="text" pInputText placeholder="" [(ngModel)]="selectedItem.phoneNo" [disabled]="true" />
              </div>
            </div>
            <div class="formgrid grid">
              <div class="field col">
                <label><strong>Chuyên khoa</strong></label>
                <input type="text" pInputText placeholder="" [(ngModel)]="selectedItem.departmentName" [disabled]="true" />
              </div>
              <div class="field col">
                <label><strong>Ngày hẹn khám</strong></label>
                <p-calendar [showIcon]="true" [showIcon]="true" appendTo="body" [dateFormat]="'dd/mm/yy'" [(ngModel)]="appointmentStringDate" [disabled]="true"></p-calendar>
              </div>
            </div>
            <div class="formgrid grid">
              <div class="field col">
                <label><strong>Ngày đặt lịch</strong></label>
                <p-calendar [showIcon]="true" [showIcon]="true" appendTo="body" [dateFormat]="'dd/mm/yy'" [disabled]="true" [(ngModel)]="dobStringDate"></p-calendar>
              </div>
              <div class="field col">
                <label><strong>Khung giờ</strong></label>
                <p-calendar [showButtonBar]="true" placeholder="Ngày đăng kí" [showIcon]="true" [disabled]="true" appendTo="body" [(ngModel)]="visitTimeStringDate"></p-calendar>
              </div>
            </div>
            <form [formGroup]="statusForm">
              <div class="formgrid grid">
                <div class="field col">
                  <textarea pKeyFilter="int" rows="5" cols="30" class="w-full" pInputTextarea placeholder="Ghi chú" formControlName="node"></textarea>
                </div>
              </div>
              <div class="formgrid grid">
                <div class="field col">
                  <button pButton pRipple label="Lưu" icon="pi pi-check" class="p-button-text" (click)="updateStatus()"></button>
                </div>
              </div>
            </form>
          </div>
          <div class="col-5">
            <form [formGroup]="statusForm">
              <div class="formgrid grid">
                <div class="field col">
                  <label
                    ><strong>Trạng thái: </strong><span class="text-red-500">{{ selectedItem.status | appointmentStatusString }}</span></label
                  >
                  <p-dropdown [options]="APPOINTMENT_STATUS" optionLabel="label" optionValue="value" appendTo="body" [style]="{ height: '40px', width: '250px' }" formControlName="status"></p-dropdown>
                </div>
              </div>
              <div class="formgrid grid">
                <div class="field col">
                  <label
                    ><strong>Mức độ ưu tiên: </strong><span class="text-red-500">{{ selectedItem.priority | appointmentPriorityString }}</span></label
                  >
                  <p-dropdown [options]="APPOINTMENT_PRIORITY" optionLabel="label" optionValue="value" appendTo="body" [style]="{ height: '40px', width: '250px' }" formControlName="priority"></p-dropdown>
                </div>
              </div>
            </form>
          </div>
        </div>
        <!-- <div class="car"> -->
        <!-- <h4><strong>Lịch sử chỉnh sửa</strong></h4> -->
        <!-- <p-scrollPanel [style]="{ height: '150px', width: '100%' }"> -->
        <!-- <h5>sadas</h5>
            <span>ssdasdsa</span> -->
        <!-- </p-scrollPanel> -->
        <!-- </div> -->
      </ng-template>
      <ng-template pTemplate="footer">
        <button pButton pRipple label="Đóng" icon="pi pi-times" class="p-button-text text-red-600" (click)="isVisibleAppointmentDlg = false"></button>
      </ng-template>
    </p-dialog>
  </div>
</div>
